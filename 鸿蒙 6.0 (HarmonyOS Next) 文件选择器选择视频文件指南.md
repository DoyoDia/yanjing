# 鸿蒙 6.0 (HarmonyOS Next) 文件选择器选择视频文件指南

为了实现全景视频播放器中选择本地视频文件的功能，您需要使用鸿蒙系统提供的 **文件选择器（FilePicker）** 模块。

在 HarmonyOS Next 中，推荐使用 `@kit.CoreFileKit` 模块下的 `picker` 接口，特别是 **`DocumentViewPicker`**，它用于选择通用文件类型，通过配置过滤器即可实现视频文件的选择。

## 一、核心接口与模块

| 模块/接口 | 描述 |
| :--- | :--- |
| `@kit.CoreFileKit` | 鸿蒙文件基础服务套件，包含 `picker` 模块。 |
| `picker.DocumentViewPicker` | 文件选择器实例，用于拉起系统文件选择界面。 |
| `picker.DocumentSelectOptions` | 文件选择的配置选项，用于定义选择数量、文件类型等。 |
| `DocumentViewPicker.select()` | 核心方法，拉起文件选择器，并返回用户选择的文件 URI 列表。 |

## 二、选择视频文件的关键配置

通过配置 `DocumentSelectOptions` 中的 `fileSuffixFilters` 属性，可以精确控制用户只能选择视频文件。

| 属性 | 类型 | 描述 | 示例值 |
| :--- | :--- | :--- | :--- |
| `maxSelectNumber` | `number` | 允许选择的最大文件数量。 | `1` (单选) |
| `selectMode` | `DocumentSelectMode` | 选择模式，`FILE` 表示选择文件。 | `picker.DocumentSelectMode.FILE` |
| `fileSuffixFilters` | `string[]` | **关键**：文件后缀名过滤器，用于限制文件类型。 | `['.mp4', '.mov', '.webm', '.avi']` |

## 三、ArkTS 示例代码

以下是使用 `DocumentViewPicker` 选择单个视频文件的完整 ArkTS 示例代码。

```typescript
import { picker } from '@kit.CoreFileKit';
import { common } from '@kit.AbilityKit';
import { BusinessError } from '@kit.BasicServicesKit';

/**
 * 调用文件选择器选择单个视频文件
 * @param context 当前 Ability 的 UIAbilityContext
 * @returns Promise<string | undefined> 选中的视频文件 URI，如果取消则返回 undefined
 */
async function selectVideoFile(context: common.UIAbilityContext): Promise<string | undefined> {
  try {
    // 1. 创建 DocumentViewPicker 实例
    const documentViewPicker = new picker.DocumentViewPicker(context);

    // 2. 配置选择选项
    const documentSelectOptions: picker.DocumentSelectOptions = {
      // 允许选择的文件数量，这里设置为 1
      maxSelectNumber: 1, 
      
      // 关键：设置文件后缀过滤器，只允许选择常见的视频文件
      fileSuffixFilters: ['.mp4', '.mov', '.webm', '.avi'], 
      
      // 选择模式：FILE 表示选择文件
      selectMode: picker.DocumentSelectMode.FILE,
    };

    // 3. 调用 select() 方法拉起文件选择器
    // select() 返回一个 Promise，解析后得到一个包含文件 URI 的数组
    const uris: string[] = await documentViewPicker.select(documentSelectOptions);

    if (uris.length > 0) {
      const videoUri = uris[0];
      console.info(`成功选择视频文件，URI: ${videoUri}`);
      return videoUri;
    } else {
      console.info('用户取消了文件选择');
      return undefined;
    }

  } catch (err) {
    const error = err as BusinessError;
    console.error(`调用文件选择器失败，错误码: ${error.code}, 消息: ${error.message}`);
    return undefined;
  }
}

// 示例调用 (需要在 Ability 的 UIAbilityContext 中执行)
// let videoUri = await selectVideoFile(this.context);
// if (videoUri) {
//   // 将 videoUri 传递给 AVPlayer.url 进行播放
// }
```

## 四、后续处理与权限说明

1.  **获取 URI**：`select()` 方法返回的是一个或多个文件的 **URI (Uniform Resource Identifier)** 字符串。
2.  **临时权限**：通过 `select()` 获取的 URI 仅具有**临时只读权限**。这意味着您的应用可以在当前会话中读取该文件，但当应用退出后台或系统回收权限后，该 URI 将失效。
3.  **AVPlayer 使用**：您在上一个问题中使用的 `AVPlayer.url` 接口可以直接接收这个返回的 URI 字符串作为视频源进行播放。

---

## 参考文献

[1] 选择用户文件 - Core File Kit（文件基础服务）- 华为HarmonyOS开发者. URL: [https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/select-user-file](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/select-user-file)
[2] @ohos.file.picker (选择器) - API参考 - 华为HarmonyOS开发者. URL: [https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-file-picker-0000001811318210](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-file-picker-0000001811318210)
